test:
  stage: test
  tags: ["self-hosted"]
  image: python:3.11-slim
  variables:
    PYTHONPATH: "$CI_PROJECT_DIR"
    PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  before_script:
    - pip install --upgrade pip
    - pip install --cache-dir "$PIP_CACHE_DIR" -r requirements.txt
  script:
    - pytest -v --cov=app --cov-report=term --cov-report=xml
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
  allow_failure: true
