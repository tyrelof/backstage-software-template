apiVersion: scaffolder.backstage.io/v1beta3
title: Include TechDocs (MkDocs)
type: boolean
default: true
ciProvider:
title: CI provider
type: string
default: github
enum: [github, gitlab]


steps:
- id: fetch-base
name: Fetch skeleton
action: fetch:template
input:
url: ./skeleton
targetPath: ./
values:
name: ${{ parameters.name }}
system: ${{ parameters.system }}
owner: ${{ parameters.owner }}
description: ${{ parameters.description }}
framework: ${{ parameters.framework }}
phpVersion: ${{ parameters.phpVersion }}
enableDocker: ${{ parameters.enableDocker }}
enableHelm: ${{ parameters.enableHelm }}
enableTechDocs: ${{ parameters.enableTechDocs }}
ciProvider: ${{ parameters.ciProvider }}


- id: publish
name: Publish to repository
action: publish:github
if: ${{ parameters.repoUrl | parseRepoUrl | isHost 'github.com' }}
input:
repoUrl: ${{ parameters.repoUrl }}
defaultBranch: main
repoVisibility: private


- id: publish-gitlab
name: Publish to GitLab
action: publish:gitlab
if: ${{ parameters.repoUrl | parseRepoUrl | isHost 'gitlab.com' }}
input:
repoUrl: ${{ parameters.repoUrl }}
defaultBranch: main
visibility: private


- id: register
name: Register in Backstage catalog
action: catalog:register
input:
repoContentsUrl: ${{ steps['publish']?.output.repoContentsUrl || steps['publish-gitlab']?.output.repoContentsUrl }}
catalogInfoPath: "/catalog-info.yaml"


output:
links:
- title: Repository
url: ${{ steps['publish']?.output.remoteUrl || steps['publish-gitlab']?.output.remoteUrl }}
- title: Open in Backstage
icon: catalog
entityRef: ${{ steps['register'].output.entityRef }}